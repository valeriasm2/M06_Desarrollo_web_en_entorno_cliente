<!DOCTYPE html>
<html lang="es">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Formulario de Perfiles</title>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <h1>Formulario de Perfiles</h1>

    <div class="main-layout">
      <div id="side-wrapper">
        <form id="formulario" autocomplete="off">
          <label for="nombre">Nombre:</label>
          <input type="text" name="nombre" />
          <span id="nombreError" class="error"></span>

          <div class="intereses-label">Intereses</div>
          <label><input type="checkbox" name="intereses" value="Videojuegos" />Videojuegos</label>
          <label><input type="checkbox" name="intereses" value="Deportes" />Deportes</label>
          <label><input type="checkbox" name="intereses" value="Lectura" />Lectura</label>
          <span id="interesesError" class="error"></span>

          <label for="foto">Foto:</label>
          <input type="file" name="foto" accept="image/*" />
          <span id="fotoError" class="error"></span>

          <button type="submit">Crear perfil</button>
        </form>
        
        <div>
          <button id="toggle-perfiles-btn">Ocultar perfiles</button>
        </div>

      </div>

      <div id="contenedor"></div>
      
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
      const $formulario = $('#formulario');
      const $contenedor = $('#contenedor');
      const $togglePerfilesBtn = $('#toggle-perfiles-btn');

      function validarNombre(nombre) {
        if (!nombre.trim()) {
          $('#nombreError').text('El nombre no puede estar vacío');
          return false;
        }
        $('#nombreError').text('');
        return true;
      }

      function validarIntereses(intereses) {
        if (!intereses.length) {
          $('#interesesError').text('Selecciona al menos 1 interés');
          return false;
        }
        $('#interesesError').text('');
        return true;
      }

      function validarFoto(foto) {
        if (!foto || !foto.type || !foto.type.startsWith('image/')) {
          $('#fotoError').text('Selecciona una imagen');
          return false;
        }
        $('#fotoError').text('');
        return true;
      }

      function crearTarjeta(perfil) {
        const $d = $('<div>').addClass('tarjeta');
        $d.append($('<img>').attr({ src: perfil.foto, alt: `imagen de ${perfil.nombre}` }));
        $d.append($('<h3>').text(perfil.nombre));
        const $ul = $('<ul>');
        perfil.intereses.forEach(i => $ul.append($('<li>').text(i)));
        $d.append($ul);
        return $d[0];
      }

      $formulario.on('submit', function (e) {
        e.preventDefault();
        const f = new FormData($formulario[0]);
        const nombre = f.get('nombre');
        const intereses = f.getAll('intereses');
        const foto = f.get('foto');

        let ok = validarNombre(nombre) && validarIntereses(intereses) && validarFoto(foto);
        if (!ok) return;

        const perfil = { nombre: nombre, intereses: intereses, foto: URL.createObjectURL(foto) };
        $contenedor.append(crearTarjeta(perfil));
        $formulario[0].reset();
      });

      // Fade In/Fade Out para mostrar/ocultar perfiles
      let contenedorVisible = true;
      $togglePerfilesBtn.on('click', function () {
        if (contenedorVisible) {
          $contenedor
            .addClass('fade-out')
            .one('animationend', function () {
              $contenedor.hide().removeClass('fade-out');
              $togglePerfilesBtn.text('Mostrar perfiles');
              contenedorVisible = false;
            });
        } else {
          $contenedor
            .show()
            .addClass('fade-in')
            .one('animationend', function () {
              $contenedor.removeClass('fade-in');
            });
          $togglePerfilesBtn.text('Ocultar perfiles');
          contenedorVisible = true;
        }
      });
    </script>
  </body>

</html>